{% extends "base.html" %}

{% load base36 %}
{% load nbsp %}

{% block title %}
{% if category %}
    {{ viewed_user.username }}'s {{ category.element_plural }}
{% else %}
    {{ viewed_user.username }}
{% endif %}
 - Archfinch
{% endblock %}

{% block content %}

{% if your_profile %}
<h1>Welcome {{ viewed_user.username }}</h1><br />
{% endif %}

{% if not user.is_authenticated %}
<div class="big" style="color: #000000">
    <p>See how similar you are to {{ viewed_user.username }}. <a href="/">Get an account</a> on Archfinch.</p>
</div>
{% endif %}

<div id="content_left">

{% for opinion in opinions %}

<div class="box opinion">
    <div class="category_element">
        {% if your_profile or not user.is_authenticated %}
        {{ opinion.item.category.element_singular|capfirst }}
        {% else %}
        {{ opinion.category_singular|capfirst }}
        {% endif %}
    </div>
    <div class="rating rating{{ opinion.rating }}" {% if your_profile %}id="yr_{{ opinion.item_id|base36 }}"{% endif %}>{{ opinion.rating }}</div>
    <div class="title">
    {% if your_profile or not user.is_authenticated %}
    <span><a href="{% url main.views.item opinion.item_id|base36 opinion.item|slugify %}">{{ opinion.item }}</a></span>
    {% else %}
    <span><a href="{% url main.views.item opinion.item_id|base36 opinion.item_name|slugify %}">{{ opinion.item_name }}</a></span>
    {% endif %}

    </div>
    {% if user.is_authenticated %}
    <div class="user_opinion" item="{{ opinion.item_id|base36 }}">

    {% if not your_profile %}
    <div class="your_opinion {% if not opinion.your_rating %}nodisplay{% endif %}">
        <span class="rating_label">Your opinion:</span> <div id="yr_{{ opinion.item_id|base36 }}" class="rating_small rating{{ opinion.your_rating }}">{{ opinion.your_rating }}</div>
    </div>
    {% endif %}

    <div class="user_rate">
        <span class="rating_label">Rate:</span>
        <span class="rating_small rate {% if opinion.your_rating == 1 or your_profile and opinion.rating == 1 %}rated{% endif %} rating1">1</span>
        <span class="rating_small rate {% if opinion.your_rating == 2 or your_profile and opinion.rating == 2 %}rated{% endif %} rating2">2</span>
        <span class="rating_small rate {% if opinion.your_rating == 3 or your_profile and opinion.rating == 3 %}rated{% endif %} rating3">3</span>
        <span class="rating_small rate {% if opinion.your_rating == 4 or your_profile and opinion.rating == 4 %}rated{% endif %} rating4">4</span>
        <span class="rating_small rate {% if opinion.your_rating == 5 or your_profile and opinion.rating == 5 %}rated{% endif %} rating5">5</span>
        {% if your_profile %}
        <span class="rating_small rate delete">x</span>
        {% endif %}
    </div>
    <div class="rating_small_hint" id="rsh_{{ opinion.item_id|base36 }}"></div>
    <img src="/media/images/ajax-loader.gif" class="loading nodisplay" id="ld_{{ opinion.item_id|base36 }}">
    </div>
    {% endif %}
</div>
{% empty %}
    <div class="big">
        <p>Rate some things!</p>
        <form action="{% url search.views.query %}"><input type='text' id='search_inline' name='q' {% if query %}value='{{ query }}'{% else %}value='Find something to rate...' onClick='this.value=""'{% endif %}><input type='submit' value='Search'></form>
        <p>The more you rate, the more accurately we can recommend you new things.</p>
    </div>
{% endfor %}
{% if left > 0 %}
    <span class="smalltext">
    <p>There {{ left|pluralize:"is,are" }} {{ left }} more result{{ left|pluralize }}.
    {% if left <= 100 %}
        <a href="{% url user-overview-paged viewed_user.username category_slug|default:"" start|add:n 100 %}">Show {{ left|pluralize:"it,them" }}</a>.
    {% else %}
        Show the next <a href="{% url user-overview-paged viewed_user.username category_slug|default:"" start|add:n 100 %}">100</a>.
    {% endif %}
    </p></span>
{% endif %}

</div>
<div id="content_right">

<b>{{ viewed_user.username }}</b>

<br /><br />
{% if not your_profile and user.is_authenticated %}
<div style='float: left; font-size: 12px; padding: 0 1.5em 2em 0;'>Similarity:</div> <div style='float: left; margin-top: 3px'>{% include "includes/similarity_bar.html" %}</div>
<br /><br />
{% endif %}


{% if categories|length > 1 %}
<div class="category_filter">
Show only {{ viewed_user.username }}'s
{% for id, repr, slug in categories %}
{% if not category_id %}{{ forloop.last|yesno:"or ," }}{% endif %}<a href="{% url user-overview-slugged viewed_user.username slug %}">{{ repr|nbsp }}</a>{{ forloop.last|yesno:",&#44;"|safe}}{% endfor %}{% if category_id %} or <a href="{% url user-overview-simple viewed_user.username %}">everything</a>.{% else %}.{% endif %}
</div>
{% endif %}

</div>

{% endblock %}
