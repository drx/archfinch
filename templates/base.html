<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        return false
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>{% block title %}Archfinch{% endblock %}</title>
    <link rel="stylesheet" href="/style.css" />
    <!-- temporary, put in style.css later -->
    <style>
        body
        {
            font-family: Verdana;
            background-color: #ffffff;
            border: 0;
            margin: 0;
        }
        a
        {
            text-decoration: none;
            color: #0055ee;
        }
        a:hover
        {
            color: #0099ff;
        }
        #content
        {
            margin: 10px;
        }
        #content_left
        {
            float: left;
            width: 45em;
        }
        #content_right
        {
            margin-left: 45em;
        }
        ul.menu
        {
            list-style-type: none;
            padding: 0;
        }
        ul.menu li
        {
            display: inline;
            margin-left: 5px;
        }
        .opinion .title
        {
            color: #333333;
            padding: 8px 4px 4px 4px;
            margin: 2px;
        }
        .opinion .title a
        {
            color: #333333;
            text-decoration: none;
        }
        .opinion .category
        {
            float: right;
            padding: 4px 8px 4px 4px;
            margin: 2px;
            display: none;
        }
        .opinion.highlight .category
        {
            display: block;
        }
        .box
        {
            padding-bottom: 3px;
            width: 40em;
        }
        .user_opinion
        {
            font-size: 10px;
            margin-bottom: 15px;
        }
        .box.highlight
        {
            background-color: #f8f8ff;
        }
        table
        {
            border-spacing: 0;
        }
        td
        {
            padding: 5px;
        }
        .likes 
        {
            color: #ffffff;
        }
        .highlight .likes
        {
            color: #aaaaaa;
            font-size: 10px;
        }
        .category_filter
        {
            font-size: 11px;
            margin-bottom: 10px;
            color: #cccccc;
        }
        .category_filter a
        {
            color: #aaaaaa;
        }
        .category_element
        {
            font-size: 11px;
            color: #aaaaaa;
        }
        .opinion .category_element
        {
            color: #bbbbbb;
            float: left;
        }
        .opinion.highlight .category_element
        {
            display: none;
        }
        .rating, .rating_small
        {
            float: left;
            text-align: center;
            cursor: default;
            font-weight: bold;
        }
        .rating_small
        {
            width: 16px;
            height: 16px;
            font-size: 10px;
            padding: 0 0 0 0;
            line-height: 15px;
        }
        .rating
        {
            padding: 0 0 0 0;
            margin: 5px 8px 5px 5px;
            width: 30px;
            height: 30px;
            line-height: 27px;
        }
        .rating1
        {
            background-color: #f02000;
            color: #ffffff;
        }
        .rating2
        {
            background-color: #ffcc00;
            color: #ffffff;
        }
        .rating3
        {
            background-color: #fff600;
            color: #ffffff;
        }
        .rating4
        {
            background-color: #88f000;
            color: #ffffff;
        }
        .rating5
        {
            background-color: #00a020;
            color: #ffffff;
        }
        /*.rating1.rate
        {
            background-color: #fec0c0;
        }
        .rating2.rate
        {
            background-color: #fceec0;
        }
        .rating3.rate
        {
            background-color: #fcfacd;
        }
        .rating4.rate
        {
            background-color: #eefcc0;
        }
        .rating5.rate
        {
            background-color: #c0e8c8;
        }*/
        .rating_label
        {
            float: left;
            margin-right: 5px;
        }
        .rate.rating_small
        {
            opacity: 0.15;
        }
        .rated.rating_small
        {
            opacity: 1.0;
        }
        .delete
        {
            margin-left: 10px;
        }
        .your_opinion
        {
            display: inline;
        }
        .highlight .your_opinion
        {
            display: none;
        }
        .user_rate
        {
            display: none;
        }
        .highlight .user_rate
        {
            display: inline;
        }
        .nodisplay
        {
            display: none;
        }
        .rating_small_hint
        {
            float: left;
            margin-left: 2em;
            color: #b6b6c0;
        }
        #logo
        {
            margin: 0.75em;
            font-family: Trebuchet MS;
            font-weight: bold;
            font-size: 24px;
            color: #0099ff;
        }
        #logo a
        {
            color: inherit;
            text-decoration: none;
        }
        #navbar
        {
            font-size: 10px;
            margin-bottom: 30px;
            margin-left: 1.5em;
        }
        #navbar a
        {
            color: #0055ee;
        }
        #navbar a:hover
        {
            color: #0099ff;
        }
        .ajaxform
        {
            margin-left: 10px;
            margin-top: 10px;
        }
        .ajaxform input
        {
            width: 10em;
            margin-right: 1em;
        }
        input[type="text"], input[type="password"]
        {
            border: 1px solid #0099ff;
            color: #333333;
        }
        .ajaxform .error
        {
            color: #ff0000;
            margin-top: 1em;
        }
        .similarity .bar
        {
            height: 10px;
            float: left;
            background-color: #c0eeff;
        }
        .similarity
        {
            width: 120px;
            float: left;
            border: 1px solid #80ccff;
            background-color: #ffffff;
        }
    </style>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript">
(function($) {
  $.fn.disableTextSelect = function() {
      return this.each(function(){
        if($.browser.mozilla){//Firefox
          $(this).css("MozUserSelect","none");
        }else if($.browser.msie){//IE
          $(this).bind("selectstart",function(){return false;});
        }else{//Opera, etc.
          $(this).mousedown(function(){return false;});
        }
      });
  }
  $(function($){
      $(".rating,.rating_small").disableTextSelect();
  });
})(jQuery); 
function get_item_id(self)
{
    item_id = $(self).parents(".user_opinion").attr("item")
    return item_id
}
function rating_to_hint(r)
{
    switch (r)
    {
        case '1': return 'Hate it'
        case '2': return 'Dislike it'
        case '3': return 'Neutral to it'
        case '4': return 'Like it'
        case '5': return 'Love it'
        case 'x': return 'Delete this opinion'
    }
    return '?'
}
$(document).ready(function(){
    $(".box").hover(
        function(e){
            $(this).addClass('highlight')
        },
        function(e){
            $(this).removeClass('highlight')
        }
    )
    $(".user_rate .rating_small").hover(
        function(e){
            $(this).removeClass('rate')
            item_id = get_item_id(this)
            rsh = $("#rsh_"+item_id)
            rsh.html(rating_to_hint($(this).html()))
        },
        function(e){
            $(this).addClass('rate')
            item_id = get_item_id(this)
            rsh = $("#rsh_"+item_id)
            rsh.html('')
        }
    )
    $(".user_rate .rating_small").click(function(e)
    {
        if ($(this).hasClass("rated"))
        {
            return false;
        }
        item_id = get_item_id(this)
        rating = $(this).html()
        if (rating == 'x')
        {
            opinion = $(this).parents(".opinion")
            $.getJSON("/opinion/remove/"+item_id, function(data){
                opinion.hide('slow')
            })
        }
        else
        {
            $.getJSON("/opinion/set/"+item_id+"/"+rating)
            $(this).siblings().removeClass("rated")
            $(this).addClass("rated")
            yr = $("#yr_"+item_id)
            yr.removeClass("rating1 rating2 rating3 rating4 rating5")
            yr.addClass("rating"+rating)
            yr.html(rating)
            yr.parent().removeClass("nodisplay")
        }
    })
    $("#menu_logout").click(function(e)
    {
        $.getJSON("/account/logout/ajax", function(data)
            {
                $("#menu_loggedin").addClass("nodisplay") 
                $("#menu_notloggedin").removeClass("nodisplay") 
            })
        e.preventDefault()
    })
    $("#menu_login").click(function(e)
    {
        $("#loginform").toggle('fast')
        $("#signupform").hide('fast')
        e.preventDefault()
    })
    $("#menu_signup").click(function(e)
    {
        $("#signupform").toggle('fast')
        $("#loginform").hide('fast')
        e.preventDefault()
    })
    $("#loginform").submit(function(e)
    {
        $.ajax({
            url: "/account/login/ajax",
            dataType: "json",
            type: "POST",
            data: $(this).serialize(),
            success: function(data)
            {
                if (data['success'])
                {
                    username = data['username']
                    $("#menu_user").html(username).attr("href", "/user/"+username)
                    $("#menu_loggedin").removeClass("nodisplay")
                    $("#menu_notloggedin").addClass("nodisplay")
                    $("#loginform").hide('fast')
                }
                else
                {
                    $("#loginform_error").html(data['error_msg']).show().delay(2000).fadeOut('slow')
                }
            }
        })
        e.preventDefault()
    })
    $("#signupform").submit(function(e)
    {
        $.ajax({
            url: "/account/signup/ajax",
            dataType: "json",
            type: "POST",
            data: $(this).serialize(),
            success: function(data)
            {
                if (data['success'])
                {
                    username = data['username']
                    $("#menu_user").html(username).attr("href", "/user/"+username)
                    $("#menu_loggedin").removeClass("nodisplay")
                    $("#menu_notloggedin").addClass("nodisplay")
                    $("#signupform").hide('fast')
                }
                else
                {
                    $("#signupform_error").html(data['error_msg']).show().delay(2000).fadeOut('slow')
                }
            }
            /* TODO: error */
        })
        e.preventDefault()
    })
});
</script>
</head>
<body>
    <div id="logo">
        <a href="/">Archfinch</a>
    </div>
    <div id="navbar">
        <ul class="menu">
            <span id="menu_loggedin" {% if not user.is_authenticated %}class="nodisplay"{% endif %}>
            {% if user.is_authenticated %}
            <li> <a href="{% url users.views.overview user.username %}" id="menu_user">{{ user.username }}</a>
            {% else %}
            <li> <a href="" id="menu_user"></a>
            {% endif %}
            <li> <a href="{% url logout %}" id="menu_logout">logout</a>
            </span>
            <span id="menu_notloggedin" {% if user.is_authenticated %}class="nodisplay"{% endif %}>
            <li> <a href="{% url account.views.signup %}" id="menu_signup">signup</a>
            <li> <a href="{% url login %}" id="menu_login">login</a>
            </span>
            <li> <a href="{% url users.views.similar %}">similar users</a>
            <li> <a href="{% url main.views.recommend %}">things you might like</a>
            <li> <form style="display:inline" action="{% url search.views.query %}"><input type='text' id='search' name='q' value='Search...' onClick='this.value=""'></form>
            <form method="post" id="loginform" action="{% url login-ajax %}" class="nodisplay ajaxform">
                <label for="id_username">Username:</label>
                <input id="id_username" type="text" name="username" maxlength="30" />
                <label for="id_password">Password:</label>
                <input type="password" name="password" id="id_password" />
                {% csrf_token %}
                <input type="hidden" name="next" value="" />
                <div class="nodisplay"><input type="submit" value="Login"></div>
                <div id="loginform_error" class="error"></div>
            </form>
            <form method="post" id="signupform" action="{% url signup-ajax %}" class="nodisplay ajaxform">
                <label for="id_username">Username:</label>
                <input id="id_username" type="text" name="username" maxlength="30" />
                <label for="id_password1">Password:</label>
                <input type="password" name="password1" id="id_password1" />
                <label for="id_password2">Password verification:</label>
                <input type="password" name="password2" id="id_password2" />
                {% csrf_token %}
                <div class="nodisplay"><input type="submit" value="Sign up!"></div>
                <div id="signupform_error" class="error"></div>
            </form>
        </ul>
    </div>

    <div id="content">
        {% block content %}{% endblock %}
    </div>
</body>
</html>
